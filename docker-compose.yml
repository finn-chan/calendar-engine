version: '3.8'

services:
  calendar-engine:
    image: calendar-engine:latest
    container_name: calendar-engine
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    volumes:
      # Configuration directory
      - ./config:/config
      # Data directory
      - ./data:/data
      # Logs directory
      - ./logs:/logs
    environment:
      # Timezone setting (use your local timezone, e.g., Asia/Shanghai, America/New_York, Europe/London)
      - TZ=UTC
      # Configuration file path
      - CONFIG_PATH=/config/config.yaml
      # Python unbuffered output
      - PYTHONUNBUFFERED=1

      # Run sync on container start (default: true)
      # Set to false to disable initial sync
      # - SYNC_ON_START=false

      # Sync schedules - Configure your sync frequency here
      # Format: minute hour day month weekday
      # Examples:
      #   0 */6 * * *    = Every 6 hours
      #   0 8,20 * * *   = Daily at 8:00 and 20:00
      #   */30 * * * *   = Every 30 minutes
      # If not specified, defaults are:
      #   Contacts: 0 8 * * * (daily at 8:00 AM)
      #   Tasks: 0 */6 * * * (every 6 hours)
      - CONTACTS_SCHEDULE=0 8 * * *
      - TASKS_SCHEDULE=0 */6 * * *

    healthcheck:
      test: [ "CMD", "test", "-f", "/data/tasks.ics", "-o", "-f", "/data/contacts.ics" ]
      interval: 1h
      timeout: 10s
      retries: 3
      start_period: 2m

    networks:
      - calendar-net

networks:
  calendar-net:
    driver: bridge
